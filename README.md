# Secure Light-weight Stream Data Outsourcing for Internet of Things

## Introduction
This is the demo codes for the paper "Secure Light-weight Stream Data Outsourcing for Internet of Things".

## Development
The codes are written in C++ under Debian 10, and tested under Raspbian Buster (Raspberry Pi 4), Debian 10, and Ubuntu 18.04. The dependent libraries are OpenSSL and PBC Library. Please follow these steps:

### Install g++ and make
```
$ sudo apt-get install g++ make
```

### Install OpenSSL (Development Files)
```
$ sudo apt-get install libssl-dev
```

### Install GMP Library
Download pbc-0.5.14.tar.gz from https://crypto.stanford.edu/pbc/download.html, extract all the files into a new directory and enter it, then:
```
$ sudo apt-get install libgmp-dev flex bison
$ ./configure
$ make
$ sudo make install
$ sudo ldconfig
```

### Compile

#### PMN
Copy PMN.cpp and a.param to a directory and enter it, then:
```
$ g++ PMN.cpp -o PMN -lcrypto -lgmp -lpbc
```

#### RS
Copy RS.cpp to a directory and enter it, then:
```
$ g++ RS.cpp -o RS -lcrypto -lgmp -lpbc
```

#### Designated Verifier
Copy Designated-Verifier.cpp to a directory and enter it, then:
```
$ g++ Designated-Verifier.cpp -o Designated-Verifier -lcrypto -lgmp -lpbc
```

#### Witness Verifiers
For each witness verifier, copy Witness-Verifier.cpp to a directory and enter it, then:
```
$ g++ Witness-Verifier.cpp -o Witness-Verifier -lcrypto -lgmp -lpbc
```

#### Node
Copy Node.cpp to a directory and enter it, then:
```
$ g++ Node.cpp -o Node -lcrypto -lgmp -lpbc
```

## Run

### Run PMN
```
$ ./PMN 6000 65536
```
Please replace 6000 to the actual port of the PMN, replace 65536 to the actual sector number for each block. When the PMN has started, please do not close the terminal.

### Run RS
```
$ ./RS 192.168.0.1 6000 6100
```
Please replace 192.168.0.1 and 6000 to the actual IP and port of the PMN, replace 6100 to the actual port of the RS.

A sample output:
```
RS emulation starts.
g2 = [3835290714881499063234722596030330929525191950031135780532373609768197739884147203712326636053061263296030595072401626259528919901924379183754351262762991, 1557593106912541163068444538830358336808289563720837536371742010962165882406442235712410922255466790569518046577982578410592257310883169826417478380641560]
mpk = [5533609620711009570460968830485274902616134816701372277935470669007133656517351826248894833683530024848430029472935961659301422427480560448612504209726234, 6998948862779711106598083854984800956597563074212535386668429082455946854416018334749776610497122462554561321439543324371386730915342588251131343177589464]
ssk = 5937288918020491777510297131658657881687619343
spk = [8123771767905357106565847111338528797143734906740761995069489531804937417493084405877041673768155557534794245573406501153816614979127361974675906487152487, 6245449595950244824696774705815424024465853306315824158978652142399075735605035312575469708935487275885251010596507620679636948016188001244966223282196515]
Waiting for the CREATE request...
Receiving the request...
Receiving the blocks and HVTs of fid...
NID: nid, FID: fid, blocks: 1024, nonce: 5fab7b34
Generating the proof of integrity...
Time: 91047.026ms
Self-checking...
Time: 38916.736ms
The proof has been generated and self-checked.
The size of the proof is 5571029 bytes.
Sending the proof of integrity...
The proof has been sent to the designated verifier.
Waiting for the checking result...
Checking result: passed.

```

### Run Designated Verifier
```
$ ./Designated-Verifier 192.168.0.1 6000 7000
```
Please replace 192.168.0.1 and 6000 to the actual IP and port of the PMN, replace 7000 to the actual port of the designated verifier.

A Sample output (for two witness verifiers):
```
Designated verifier emulation starts.
g2 = [3835290714881499063234722596030330929525191950031135780532373609768197739884147203712326636053061263296030595072401626259528919901924379183754351262762991, 1557593106912541163068444538830358336808289563720837536371742010962165882406442235712410922255466790569518046577982578410592257310883169826417478380641560]
mpk = [5533609620711009570460968830485274902616134816701372277935470669007133656517351826248894833683530024848430029472935961659301422427480560448612504209726234, 6998948862779711106598083854984800956597563074212535386668429082455946854416018334749776610497122462554561321439543324371386730915342588251131343177589464]
sk = [155106145760112497055494784041816908503728191048358728433457396428849166199378413907251622644023249518954735759671794007605683689599499564744895687932419, 5404334170796822566603223855748775675194552569540535369418817643866762214113489265694539830931572434022332208357192317386931942539646672224390506690125450]
Waiting for the CREATE request...
NID: nid, FID: fid, blocks: 1024, nonce: 5fab7b34
Waiting for the proof of integrity...
Receiving the proof of integrity...
The size of the proof is 5571029 bytes.
Checking...
The block size is 5571994 bytes.
Sending the new block to witness 1...
Sending the new block to witness 2...
Waiting for the responses from the witness verifiers...
The blockchain has reached consensus.
Time: 80591.476ms
The checking result has been sent to the node.
The checking result has been sent to the RS.

```

### Run Witness Verifiers
```
$ ./Witness-Verifier 192.168.0.1 6000 7100
```
Please replace 192.168.0.1 and 6000 to the actual IP and port of the PMN, replace 7100 to the actual port of the witness verifier. You should run at least two witness verifiers simultaneously. Please ensure that the IPs and ports do not conflict.

A Sample output:
```
Witness verifier emulation starts.
g2 = [3835290714881499063234722596030330929525191950031135780532373609768197739884147203712326636053061263296030595072401626259528919901924379183754351262762991, 1557593106912541163068444538830358336808289563720837536371742010962165882406442235712410922255466790569518046577982578410592257310883169826417478380641560]
mpk = [5533609620711009570460968830485274902616134816701372277935470669007133656517351826248894833683530024848430029472935961659301422427480560448612504209726234, 6998948862779711106598083854984800956597563074212535386668429082455946854416018334749776610497122462554561321439543324371386730915342588251131343177589464]
sk = [366859620011029430860085164809315285526153183385307096859387158025570314833832077902051699797801575149295101454338211987326961049395926373830275806822214, 8291940981523258575563318946329732172549742301662771511668292834092020542710308924783878723837103996821831502962702018125174927922114832826612963203610721]
Waiting for the new block...
Receiving the new block from the designated verifier...
Checking...
Time: 39848.150ms
Responded to the designated verifier.

```

### Run Node
```
$ ./Node 192.168.0.1 6000 6200 nid fid 1024
```
Please replace 192.168.0.1 and 6000 to the actual IP and port of the PMN, replace 6200 to the actual port of the node, replace "nid" to the actual ID of the node, replace "fid" to the actual ID of the file, replace 1024 to the actual block number of the file. (For a sector size 65536, a file in 1024 blocks is 1024\*65536\*16 Byte, i.e., 1 GB.) We remark that, the subsequent verification tasks (i.e., running RS, designated verifier, witness verifiers, and node more than one time under the same PMN and the same ID) is much faster than the first task, because we store some pre-computed parameters on the disk. We use this trick to accelerate batch operations for a same node.

A Sample output:
```
Node emulation starts.
Waiting for the private key...
g1 = [2535450443746766870565342284526467057801417434483108849181394869699116102562353617038255642079319137690933321224852854656268936200035930326600588432224217, 5588536360201833620404074874517398332030600505509960041495011524725411742102414114012878819868142905200965676450544331163744582056331054130252217640985018]
g2 = [3835290714881499063234722596030330929525191950031135780532373609768197739884147203712326636053061263296030595072401626259528919901924379183754351262762991, 1557593106912541163068444538830358336808289563720837536371742010962165882406442235712410922255466790569518046577982578410592257310883169826417478380641560]
mpk = [5533609620711009570460968830485274902616134816701372277935470669007133656517351826248894833683530024848430029472935961659301422427480560448612504209726234, 6998948862779711106598083854984800956597563074212535386668429082455946854416018334749776610497122462554561321439543324371386730915342588251131343177589464]
alpha = 562957191636354228287991617393447532320784398467
beta = 475699126176259525278732746996682201684820310716
sigma = [3204848417111654992623738018766685561825892254992883052076414334037659398149264169601016585544366792875355211775236376633334228766822246332574406073222411, 6293874940154986564897063209729584224198177461089355035011374561064073812661806609590988894946388209431743051086390925207456738303112122853693798323692891]
sk = [4674045085651437803447244679400816683492555256680588639083815360945618972694108713312984337305319918963499798168580761153202767417506971407869161011678622, 6087089796389408322349246127770680199164757147718207454106775742640096364225221451398618636009520341395744752957459548424453101638304688464723229680208488]
v = [8626895359320827745407306492306684332139937674834718858661705144753732833950883986385704048629854065669057039758228136665305028706873921736669018634966799, 4732540987765756395854231624313484393056028602464839019624893849227908158228361008811490416821527887071337357033775197034563971521465479821194215248698972]
Creating fid...
Generating the HVTs of fid...
Time: 123815.912ms
Sending the blocks and HVTs of fid...
1073741824 bytes blocks, 66560 bytes HVTs, and 4259970 bytes extra authentication information have been sent.
The request has been sent to the designated verifier.
Waiting for the checking result...
Time: 207843.570ms
Checking result: passed.

```
